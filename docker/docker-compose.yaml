services:
  backend:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: lingua_backend
    restart: unless-stopped
    networks: [web]
    environment:
      DATABASE_URL: postgresql://lingua:lingua@postgres:5432/lingua
      JWT_ACCESS_SECRET: "csomesome"
      JWT_REFRESH_SECRET: "somesome"
      ACCESS_TOKEN_TTL: "15m"
      REFRESH_TOKEN_TTL_DAYS: "30"
    ports:
      - "3010:3000"

  migrate:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: lingua_migrate
    networks: [ web ]
    depends_on:
      postgres:
        condition: service_healthy
    environment:
      DATABASE_URL: postgresql://lingua:lingua@postgres:5432/lingua
    command: [ "sh", "-lc", "npm run db:migrate" ]
    restart: "no"

networks:
  web:
    external: true